/* Составьте список уникальных номеров сотрудников, которые работают в компаниях, отобранных в предыдущем задании. */
WITH a1 AS (
  -- Создаём временную таблицу с уникальными названиями закрытых компаний,
  -- для которых первый раунд финансирования оказался последним
  SELECT DISTINCT name
  FROM company AS c
  WHERE status = 'closed'  -- Только закрытые компании
  AND c.id IN (
    -- Выбираем компании, которые участвовали как в первом, так и в последнем раунде
    SELECT company_id
    FROM funding_round
    WHERE is_first_round = 1 
    AND is_last_round = 1
  )
)

-- Основной запрос для получения номеров сотрудников
SELECT p.id  -- Уникальные номера сотрудников
FROM people AS p
-- Соединяем таблицы people и company для получения данных о компании сотрудника
LEFT JOIN company AS c ON p.company_id = c.id
-- Фильтруем сотрудников, работающих в компаниях из временной таблицы a1
WHERE c.name IN (SELECT name FROM a1);
